# Order_Lifecycle_Main

## 1. Общие сведения

Процесс `Order_Lifecycle_Main` описывает сквозной жизненный цикл заказа в информационной системе сервиса доставки еды «Delivery».

Процесс охватывает путь заказа от момента его оформления клиентом до завершения доставки и фиксации результата в системе.

Диаграмма процесса представлена в файлах `Order_Lifecycle_Main.bpmn`, `Order_Lifecycle_Main.png`.

---

## 2. Цель процесса

Цель процесса — обеспечить управляемую и корректную обработку заказа, включающую:

- оформление заказа клиентом;
- онлайн-оплату;
- обработку заказа рестораном;
- назначение курьера;
- доставку заказа клиенту;
- фиксацию результата выполнения.

---

## 3. Область охвата

### В рамках процесса:

- формирование и подтверждение заказа клиентом;
- обработка онлайн-оплаты;
- передача заказа ресторану;
- подтверждение и приготовление заказа;
- назначение курьера;
- доставка заказа;
- завершение заказа.

### Вне рамок процесса:

- возвраты и спорные платежи;
- расчёт маршрутов доставки;
- коммуникации вне системы (звонки, чаты и т.п.).

---

## 4. Участники процесса (Lanes)

| Lane             | Роль                                                    |
| ---------------- | ------------------------------------------------------- |
| Клиент           | Формирует заказ и инициирует оплату                     |
| Система Delivery | Управляет статусами, бизнес-логикой и интеграциями      |
| Ресторан         | Принимает и готовит заказ                               |
| Курьер           | Доставляет заказ клиенту                                |
| Платёжный сервис | Обрабатывает онлайн-оплату (внешняя система, Black Box) |

---

## 5. Основной сценарий (Happy Path)

Основной сценарий отражает стандартный путь успешно обработанного заказа.

1. Клиент выбирает ресторан и формирует корзину.
2. Клиент инициирует оформление заказа.
3. Система создаёт заказ и присваивает ему уникальный идентификатор.
4. Система переводит заказ в статус «Ожидает оплаты».
5. Клиент инициирует онлайн-оплату.
6. Система передаёт данные для оплаты в платёжный сервис.
7. Платёжный сервис возвращает успешный результат оплаты.
8. Система переводит заказ в статус «Оплачен».
9. Система передаёт оплаченный заказ ресторану.
10. Ресторан подтверждает выполнение заказа.
11. Система переводит заказ в статус «Подтверждён рестораном».
12. Ресторан готовит заказ.
13. Ресторан сообщает системе о готовности заказа.
14. Система переводит заказ в статус «Готов к доставке».
15. Система инициирует подпроцесс назначения курьера.
16. Курьер назначается на заказ.
17. Курьер получает данные заказа и адрес доставки.
18. Курьер доставляет заказ клиенту.
19. Курьер подтверждает завершение доставки.
20. Система переводит заказ в статус «Доставлен».
21. Система фиксирует историю изменений и завершает процесс.

---

## 6. Использование подпроцессов

В рамках `Order_Lifecycle_Main` используются следующие подпроцессы:

| Подпроцесс                   | Назначение                                             |
| ---------------------------- | ------------------------------------------------------ |
| `Payment_Process`            | Управляет логикой онлайн-оплаты и ожиданием результата |
| `Courier_Assignment_Process` | Управляет поиском и назначением курьера                |

Подпроцессы вызываются из основного процесса через Call Activity и инкапсулируют сложную бизнес-логику.

---

## 7. Обработка исключительных ситуаций

Процесс предусматривает обработку следующих отклонений от основного сценария:

- отсутствие доступных курьеров;
- невозможность завершения доставки курьером;
- проблемы при назначении курьера.

Для обработки этих ситуаций используются:

- Escalation Events — для передачи управления администратору;
- Boundary Events — для прерывания подпроцессов;
- альтернативные пути обработки заказов.

Исключительные сценарии вынесены в процесс `Order_Lifecycle_Exceptions` и связаны с основным процессом через события эскалации.

---

## 8. Используемые BPMN-элементы и обоснование

| Элемент           | Причина использования                           |
| ----------------- | ----------------------------------------------- |
| Lanes             | Разделение ответственности между участниками    |
| Call Activity     | Повторно используемые бизнес-процессы           |
| Message Flow      | Интеграция с платёжным сервисом                 |
| Timer Events      | Ожидание оплаты и асинхронные операции          |
| Escalation Events | Бизнес-эскалации (например, отсутствие курьера) |
| Service Tasks     | Автоматизированные действия системы             |
| User Tasks        | Действия пользователя, ресторана и курьера      |

---

## 9. Связь с требованиями

Процесс `Order_Lifecycle_Main` реализует следующие артефакты:

- Functional Requirements (FR-1 – FR-34);
- Use Cases (UC-1 – UC-6);
- Business Rules;
- Order_Statuses.

Диаграмма используется как средство проверки согласованности требований, сценариев и бизнес-логики.

---

## 10. Роль процесса в архитектуре решения

`Order_Lifecycle_Main` является центральным бизнес-процессом системы Delivery и определяет:

- последовательность обработки заказов;
- ответственность участников;
- точки интеграции;
- контроль качества и управляемость процесса.

Процесс служит основой для проектирования сервисов, API и пользовательских интерфейсов.
