# Non-Functional Requirements

## 1. Общие положения

Данный документ описывает нефункциональные требования к информационной системе сервиса доставки еды «Delivery».

Нефункциональные требования определяют качественные характеристики системы и условия её работы: устойчивость, надёжность, безопасность, сопровождаемость, масштабируемость и журналирование.

Функциональное поведение системы описано в документе `Functional_Requirements.md` и в Use Case.

---

## 2. Работа при параллельных действиях

NFR-1. Система должна обеспечивать корректную работу при одновременной работе нескольких пользователей без потери или искажения данных.

NFR-2. Система должна обеспечивать согласованное состояние заказа при параллельных изменениях его статуса, включая ситуации конкурентных обновлений из разных процессов.

---

## 3. Надёжность и целостность данных

NFR-3. Данные о заказах должны сохраняться при сбоях и перезапуске системы.

NFR-4. Изменение статуса заказа должно выполняться только в соответствии с допустимыми переходами, определёнными в модели статусов.

NFR-5. Система должна исключать возможность нахождения заказа в противоречивых состояниях, включая статусы, связанные с оплатой и доставкой.

---

## 4. Доступ и безопасность

NFR-6. Доступ к функциям системы должен предоставляться в соответствии с ролью пользователя (Клиент, Курьер, Ресторан, Администратор).

NFR-7. Пользователи должны иметь доступ только к тем данным заказа и оплаты, которые необходимы для выполнения их функций.

NFR-8. Система должна предотвращать несанкционированное изменение данных о заказах и их оплате.

NFR-9. Система не должна хранить платёжные данные клиента (включая реквизиты банковских карт).

---

## 5. Взаимодействие с платёжным сервисом

NFR-10. Повторная передача результата оплаты от платёжного сервиса не должна приводить к дублированию заказов или некорректному изменению их статусов.

NFR-11. Ошибки при взаимодействии с платёжным сервисом не должны приводить к потере данных заказа.

---

## 6. Поддержка и развитие системы

NFR-12. Система должна допускать расширение функциональности без нарушения работоспособности существующих функций.

NFR-13. Изменения в логике обработки заказов должны быть возможны без необходимости изменения несвязанных компонентов системы.

---

## 7. Журналирование и аудит

NFR-14. Система должна обеспечивать журналирование изменений статусов заказов и статусов оплаты.

NFR-15. Записи журнала изменений должны обеспечивать возможность восстановления истории обработки заказа и включать:

- идентификатор заказа;
- дату и время изменения;
- роль инициатора изменения;
- предыдущее и новое значение статуса.

NFR-16. Система должна обеспечивать корректную обработку таймеров бизнес-процессов независимо от перезапусков и сбоев.
---

## 8. Измеримые показатели качества

### 8.1 SLA/SLO доступности и времени обработки

NFR-17. Система должна обеспечивать доступность ключевых функций обработки заказа не менее **99.5% за календарный месяц**, без учёта согласованных регламентных окон общей длительностью не более **4 часов в месяц**.

NFR-18. Система должна обрабатывать операции создания заказа (FR-6, FR-8) за время не более **2 секунд на p95** и не более **5 секунд на p99**.

NFR-19. Система должна предоставлять чтение текущего статуса заказа (FR-37, FR-38) за время не более **1 секунды на p95** и не более **2 секунд на p99**.

NFR-20. Система должна обрабатывать операции изменения статуса заказа (FR-21, FR-23, FR-29, FR-30) за время не более **2 секунд на p95** и не более **5 секунд на p99**.

NFR-21. Система должна обрабатывать результат оплаты от платёжного сервиса от момента получения результата (FR-11) до фиксации статуса оплаты и заказа (FR-12, FR-14, FR-16) за время не более **10 секунд на p95** и не более **20 секунд на p99**.

NFR-22. Система должна фиксировать запись аудита события изменения статуса заказа или оплаты (FR-31, FR-45) за время не более **3 секунд на p95** и не более **6 секунд на p99** от момента возникновения бизнес-события.

### 8.2 Восстановление после сбоев

NFR-23. Система должна обеспечивать восстановление работоспособности критических функций обработки заказов после аварийного сбоя (RTO) за время не более **60 минут**.

NFR-24. Система должна обеспечивать максимально допустимую потерю данных по заказам, оплатам и истории изменений (RPO) не более **5 минут**.

### 8.3 Максимальная задержка для критических таймеров

NFR-25. Система должна выполнять переход заказа в статус Заказ не оплачен после достижения дедлайна таймера оплаты (FR-13, FR-15) с задержкой не более **60 секунд на p99**.

NFR-26. Система должна запускать очередную попытку назначения курьера после наступления таймера (FR-27) с задержкой не более **30 секунд на p99**.

NFR-27. Система должна переводить заказ в статус Курьер не назначен после достижения предельного времени назначения (FR-33) с задержкой не более **60 секунд на p99**.

