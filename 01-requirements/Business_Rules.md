# Business Rules — Delivery

Документ описывает бизнес-правила сервиса доставки еды «Delivery».

Бизнес-правила представляют собой формализованные логические ограничения, политики и условия, определяющие допустимое поведение системы и участников бизнес-процесса.  
Правила сформулированы на языке бизнеса и используются как основа для формирования функциональных и нефункциональных требований, а также пользовательских сценариев и BPMN-процессов.

---

## 1. Правила формирования заказа

**BR-1. Корзина не является заказом.**  
Добавленные клиентом блюда до оформления заказа считаются корзиной и не образуют заказ.

**BR-2. Заказ создаётся только при оформлении.**  
Заказ считается созданным только после того, как клиент инициировал оформление заказа.

**BR-3. Каждый заказ имеет уникальный идентификатор.**  
С момента создания заказа ему присваивается уникальный идентификатор, который используется во всех дальнейших процессах.

---

## 2. Правила оплаты заказа

**BR-4. Онлайн-оплата обязательна.**  
Оплата заказа осуществляется только в онлайн-формате через платёжный сервис.

**BR-5. Заказ не передаётся ресторану без оплаты.**  
Пока оплата не подтверждена платёжным сервисом, заказ не может быть направлен ресторану и не подлежит обработке.

**BR-6. Время ожидания оплаты ограничено.**  
Для оплаты заказа устанавливается таймер ожидания оплаты продолжительностью 15 минут.

**BR-7. Неоплаченный заказ закрывается.**  
Если в течение установленного времени оплата не получена, заказ переводится в статус «Заказ не оплачен» и исключается из дальнейшей обработки.

**BR-8. Результат оплаты фиксируется.**  
Любой результат взаимодействия с платёжным сервисом (успешная оплата, отказ, отсутствие ответа) должен быть зафиксирован в системе.

---

## 3. Правила обработки заказа рестораном

**BR-9. К обработке допускаются только оплаченные заказы.**  
Ресторан может получать и обрабатывать только заказы со статусом «Оплачен».

**BR-10. Ресторан обязан принять решение по заказу.**  
Ресторан обязан подтвердить или отклонить оплаченный заказ.

**BR-11. Приготовление заказа возможно только после подтверждения.**  
Ресторан может начать приготовление заказа только после его подтверждения.

**BR-12. Заказ становится доступным для доставки только после приготовления.**  
Только заказ в статусе «Готов к доставке» может быть передан в процесс назначения курьера.

---

## 4. Правила назначения курьера

**BR-13. Назначение курьера возможно только для готового заказа.**  
Курьер может быть назначен только на заказ в статусе "Готов к доставке".

**BR-14. Назначение курьера выполняется системой.**  
Выбор и назначение курьера выполняется системой автоматически в рамках процесса Courier_Assignment_Process.

**BR-15. Если курьер не назначен, требуется эскалация.**  
Если курьер не может быть назначен в рамках процесса, заказ переводится в статус «Курьер не назначен» и передаётся на рассмотрение администратору.

---

## 5. Правила доставки

**BR-16. Доставка начинается только после назначения курьера.**  
Курьер может приступить к доставке только после назначения на заказ.

**BR-17. Статус «В пути» отражает процесс доставки.**  
Статус «В пути» охватывает период от получения заказа курьером до попытки завершения доставки.

**BR-18. Результат доставки должен быть зафиксирован.**  
Каждая попытка доставки должна завершаться либо статусом «Доставлен», либо фиксацией события «Доставка не выполнена».

---

## 6. Правила управления и эскалации

**BR-19. Администратор управляет проблемными заказами.**  
Все заказы со статусами «Курьер не назначен», «Доставка не выполнена» подлежат обработке администратором.

**BR-20. Администратор вправе отменить заказ.**  
Администратор может отменить заказ, если его дальнейшее выполнение невозможно или нецелесообразно.

---

## 7. Правила целостности и истории

**BR-21. История изменений обязательна.**  
Каждое изменение статуса заказа, оплаты или доставки должно быть зафиксировано в истории заказа.

**BR-22. Заказ может находиться только в одном статусе.**  
В любой момент времени заказ может иметь только один актуальный статус из модели жизненного цикла.
