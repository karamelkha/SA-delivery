# Use Cases — Delivery

## 1. Общие положения

Документ описывает основные сценарии взаимодействия пользователей с информационной системой сервиса доставки еды «Delivery».

Use Case отражают пользовательские и системные сценарии работы и основаны на функциональных и нефункциональных требованиях проекта.  
Детальная проработка пользовательских интерфейсов и технической реализации сценариев не входит в рамки документа.

---

## 2. Акторы

**Основные акторы:**

- **Клиент** — оформляет и оплачивает заказ, отслеживает его статус
- **Ресторан** — принимает или отклоняет заказ
- **Курьер** — осуществляет доставку заказа и фиксирует ее статус
- **Администратор** — просматривает заказы, их статусы и историю обработки

**Внешние системы:**

- **Платёжный сервис** — обрабатывает онлайн-оплату заказов

---

## UC-1. Оформить и оплатить заказ

**Цель:** оформить и оплатить заказ на доставку еды.  
**Основной актор:** Клиент  
**Вторичные акторы:** Платёжный сервис, Ресторан

### Предусловия

- Клиент имеет доступ к системе.
- В системе доступны рестораны и их меню.

### Триггер

Клиент выбирает ресторан.

### Основной поток

1. Система отображает список доступных ресторанов.
2. Клиент выбирает ресторан.
3. Система отображает меню выбранного ресторана.
4. Клиент добавляет блюда в корзину.
5. Система отображает содержимое корзины и итоговую стоимость.
6. Клиент инициирует оформление заказа.
7. Система создаёт заказ и присваивает ему уникальный идентификатор.
8. Система переводит заказ в статус «Ожидает оплаты» и запускает таймер ожидания оплаты продолжительностью 15 минут.
9. Клиент инициирует процесс оплаты заказа через платёжный сервис.
10. Система передаёт данные для оплаты в платёжный сервис.
11. Платёжный сервис возвращает результат оплаты.
12. При успешной оплате система переводит заказ в статус «Оплачен».
13. Система передаёт оплаченный заказ ресторану.

### Альтернативные потоки

**A1. Результат оплаты: «Оплата не прошла»**

1. На шаге 11 платёжный сервис возвращает результат оплаты, соответствующий неуспешной оплате.
2. Система сохраняет статус оплаты заказа «Оплата не прошла».
3. Заказ остаётся в статусе «Ожидает оплаты» до истечения установленного времени ожидания оплаты.
4. Система отображает клиенту результат «Оплата не прошла» и предоставляет возможность повторить оплату.

---

**A2. Ошибка взаимодействия с платёжным сервисом**

1. На шаге 10 или 11 возникает ошибка взаимодействия с платёжным сервисом (платёжный сервис не возвращает результат оплаты).
2. Система не изменяет статус оплаты и статус заказа.
3. Заказ остаётся в статусе «Ожидает оплаты» до истечения установленного времени ожидания оплаты.
4. Система отображает клиенту сообщение о технической ошибке и предлагает повторить оплату позже.

**A3. Клиент прерывает процесс оплаты**

1. После перехода к оплате клиент прекращает процесс оплаты.
2. Платёжный сервис не возвращает результат оплаты.
3. Система не изменяет статус оплаты заказа.
4. Заказ остаётся в статусе «Ожидает оплаты» до истечения установленного времени ожидания оплаты.
5. Система отображает клиенту информацию о том, что оплата не была выполнена, и предоставляет возможность вернуться к оплате.

**A4. Истёк лимит времени на оплату заказа**

1. После перевода заказа в статус «Ожидает оплаты» система запускает таймер ожидания оплаты продолжительностью 15 минут.
2. В течение указанного времени система не получает подтверждение успешной оплаты от платёжного сервиса.
3. По истечении 15 минут система прекращает ожидание оплаты.
4. Система переводит заказ в статус «Заказ не оплачен».
5. Система отображает клиенту информацию о том, что заказ не был оплачен в установленный срок.

### Постусловия

- Заказ оплачен и передан ресторану **или**
- Заказ находится в статусе «Ожидает оплаты» **или**
- Заказ переведён в статус «Заказ не оплачен».

---

## UC-2. Обработать заказ

**Цель:** подтвердить или отклонить оплаченный заказ.  
**Основной актор:** Ресторан

### Предусловия

- Заказ успешно оплачен.

### Триггер

Ресторан открывает список заказов для обработки.

### Основной поток

1. Система отображает ресторану список поступивших заказов.
2. Ресторан открывает заказ и просматривает его состав.
3. Ресторан подтверждает возможность выполнения заказа.
4. Система обновляет статус заказа на «Подтверждён рестораном».
5. После завершения приготовления заказа рестораном система обновляет статус заказа на «Готов к доставке».
6. Система сохраняет изменения статусов и историю изменений.

### Альтернативные потоки

**A1. Отклонение заказа**

1. На шаге 3 ресторан отклоняет заказ.
2. Система обновляет статус заказа на «Отклонён».
3. Система отображает статус заказа «Отклонён» клиенту и администратору.

---

## UC-3. Назначить курьера на заказ

**Цель:** назначить курьера для доставку заказа.  
**Основной актор:** Система  
**Вторичные акторы:** Курьер, Администратор

### Предусловия

- Заказ находится в статусе «Готов к доставке».

### Триггер

Система инициирует процесс доставки заказа.

### Основной поток

1. Система определяет необходимость назначения курьера.
2. Система назначает курьера на заказ.
3. Система предоставляет курьеру информацию о заказе и адрес доставки.
4. После подтверждения получения заказа курьером система переводит заказ в статус «В пути».
5. Система сохраняет изменение статуса и историю изменений.

### Альтернативные потоки

**A1. Курьер не назначен**

1. На шаге 2 система не может назначить курьера (нет доступных курьеров).
2. Система переводит заказ в статус «Ожидает назначения курьера».
3. Система выполняет повторные попытки назначения курьера.
4. При каждой попытке система фиксирует событие в истории изменений заказа.
5. Если в течение установленного времени курьер не назначен, система переводит заказ в статус «Курьер не назначен».
6. Система уведомляет администратора о заказе, для которого курьер не назначен.
7. Администратор принимает решение:
   - назначить курьера вручную; или
   - отменить заказ.

**Постусловия для A1:**

- Заказ либо продолжает обработку после назначения курьера, либо переводится в статус «Отменён».
- В случае отмены оплаченного заказа информация об оплате сохраняется для дальнейшей обработки возврата в рамках отдельного процесса.

---

## UC-4. Обновить статус заказа в процессе доставки

**Цель:** зафиксировать ход доставки заказа и её завершение.  
**Основной актор:** Курьер

### Предусловия

- Курьер назначен на заказ.
- Заказ находится в статусе «В пути».

### Триггер

Курьер начинает доставку или фиксирует результат доставки.

### Основной поток

1. Система отображает курьеру информацию о назначенном заказе и адрес доставки.
2. После завершения доставки курьер переводит заказ в статус «Доставлен».
3. Система сохраняет новый статус заказа и фиксирует изменение в истории изменений.
4. Обновлённый статус заказа отображается клиенту и администратору.

### Альтернативные потоки

**A1. Не удалось доставить заказ**

1. Курьер не может завершить доставку заказа.
2. Курьер фиксирует событие «Доставка не выполнена» и указывает причину из доступного списка.
3. Система сохраняет событие и указанную причину.
4. Система уведомляет администратора о заказе, по которому доставка не выполнена.
5. Администратор принимает решение:
   - переназначить курьера на заказ; или
   - отменить заказ.

---

**A2. Ошибка при сохранении статуса заказа**

1. На шаге 3 или 5 возникает ошибка при сохранении статуса заказа.
2. Система уведомляет курьера о невозможности сохранить изменение статуса и предлагает повторить попытку.
3. Если повторная попытка неуспешна, система фиксирует событие и уведомляет администратора.
4. Текущий статус заказа в системе остаётся без изменений до успешного сохранения.

### Постусловия

- Статус доставки и статус заказа обновлены **или**
- Зафиксировано событие «Доставка не выполнена».
- История изменений по заказу сохранена.

---

## UC-5. Просмотреть статус заказа

**Цель:** получить информацию о текущем статусе заказа.  
**Основной актор:** Клиент

### Предусловия

- У клиента есть оформленный заказ.

### Триггер

Клиент открывает карточку заказа.

### Основной поток

1. Клиент открывает карточку заказа.
2. Система отображает текущий статус заказа.
3. Если курьер назначен на заказ, система дополнительно отображает статус доставки.

### Постусловия

- Клиент получил актуальную информацию о статусе заказа и статусе доставки (при наличии).

---

## UC-6. Просмотреть информацию по заказам

**Цель:** получить информацию о заказах для анализа их текущего состояния и истории обработки.  
**Основной актор:** Администратор

### Предусловия

- В системе существуют заказы.

### Триггер

Администратор открывает раздел мониторинга заказов.

### Основной поток

1. Система отображает список всех заказов с указанием их текущих статусов.
2. Администратор выбирает заказ для просмотра.
3. Система отображает подробную информацию по выбранному заказу, включая:
   - текущий статус заказа;
   - историю изменений статусов заказа;
   - историю изменений статуса оплаты;
   - зафиксированные ошибки или события отклонений (при наличии).

### Постусловия

- Администратор получил информацию, необходимую для анализа состояния выбранного заказа.
