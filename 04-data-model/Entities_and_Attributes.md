# Entities and Attributes — Delivery

## 1. Общие положения

Данный документ описывает основные сущности и их атрибуты для информационной системы сервиса доставки еды «Delivery».

Документ фиксирует структуру данных на уровне предметной области и используется как основа для:

- построения ER-модели;
- проектирования API и контрактов обмена данными;
- проверки согласованности требований и Use Case.

Документ не описывает физическую модель БД, индексы, ограничения на уровне СУБД и детали реализации.

---

## 2. Термины

- **Заказ** — оформленная клиентом заявка на доставку еды, создаётся в момент оформления заказа и переводится в статус «Ожидает оплаты».
- **Статусы заказа** — описаны в документе `Order_Statuses.md`.
- **Платёжный сервис** — внешняя система, обрабатывающая онлайн-оплату (Black Box).
- Возвраты и спорные операции находятся вне рамок проекта.

---

## 3. Сущности и атрибуты

### 3.1 Клиент (Customer)

| Поле          | Тип данных | Описание                          | Ключ |
| ------------- | ---------- | --------------------------------- | ---- |
| `customer_id` | INTEGER    | Уникальный идентификатор клиента  | PK   |
| `full_name`   | VARCHAR    | Отображаемое имя клиента          |      |
| `phone`       | VARCHAR    | Номер телефона клиента            |      |
| `email`       | VARCHAR    | Email клиента (если используется) |      |
| `created_at`  | DATETIME   | Дата и время создания профиля     |      |
| `is_active`   | BOOLEAN    | Признак активности аккаунта       |      |

**Связи:**

- `Customer 1 → N Order`
- `Customer 1 → N CustomerAddress`

---

### 3.2 Адрес клиента (CustomerAddress)

| Поле           | Тип данных | Описание                                          | Ключ                      |
| -------------- | ---------- | ------------------------------------------------- | ------------------------- |
| `address_id`   | INTEGER    | Уникальный идентификатор адреса                   | PK                        |
| `customer_id`  | INTEGER    | Идентификатор клиента-владельца                   | FK → Customer.customer_id |
| `label`        | VARCHAR    | Метка адреса (например, «Дом», «Работа»)          |                           |
| `full_address` | VARCHAR    | Полный адрес доставки                             |                           |
| `comment`      | VARCHAR    | Комментарий для курьера (подъезд, домофон и т.п.) |                           |
| `is_default`   | BOOLEAN    | Признак адреса по умолчанию                       |                           |
| `created_at`   | DATETIME   | Дата и время добавления адреса                    |                           |

**Связи:**

- `CustomerAddress N → 1 Customer`
- `CustomerAddress 1 → N Order` (через `Order.delivery_address_id`)

---

### 3.3 Ресторан (Restaurant)

| Поле            | Тип данных | Описание                           | Ключ |
| --------------- | ---------- | ---------------------------------- | ---- |
| `restaurant_id` | INTEGER    | Уникальный идентификатор ресторана | PK   |
| `name`          | VARCHAR    | Наименование ресторана             |      |
| `address`       | VARCHAR    | Адрес ресторана                    |      |
| `phone`         | VARCHAR    | Контактный телефон ресторана       |      |
| `is_open`       | BOOLEAN    | Доступен ли ресторан для заказов   |      |
| `created_at`    | DATETIME   | Дата и время добавления ресторана  |      |

**Связи:**

- `Restaurant 1 → N MenuItem`
- `Restaurant 1 → N Order`

---

### 3.4 Позиция меню (MenuItem)

| Поле            | Тип данных    | Описание                       | Ключ                          |
| --------------- | ------------- | ------------------------------ | ----------------------------- |
| `menu_item_id`  | INTEGER       | Идентификатор позиции меню     | PK                            |
| `restaurant_id` | INTEGER       | Идентификатор ресторана        | FK → Restaurant.restaurant_id |
| `name`          | VARCHAR       | Название блюда                 |                               |
| `description`   | VARCHAR       | Описание блюда (если нужно)    |                               |
| `price`         | DECIMAL(10,2) | Цена позиции                   |                               |
| `is_available`  | BOOLEAN       | Доступна ли позиция для заказа |                               |
| `created_at`    | DATETIME      | Дата и время создания позиции  |                               |

**Связи:**

- `MenuItem N → 1 Restaurant`
- `MenuItem 1 → N OrderItem`

---

### 3.5 Заказ (Order)

| Поле                  | Тип данных    | Описание                                        | Ключ                               |
| --------------------- | ------------- | ----------------------------------------------- | ---------------------------------- |
| `order_id`            | INTEGER       | Уникальный идентификатор заказа                 | PK                                 |
| `customer_id`         | INTEGER       | Идентификатор клиента                           | FK → Customer.customer_id          |
| `restaurant_id`       | INTEGER       | Идентификатор ресторана                         | FK → Restaurant.restaurant_id      |
| `courier_id`          | INTEGER       | Идентификатор курьера (если назначен)           | FK → Courier.courier_id (nullable) |
| `delivery_address_id` | INTEGER       | Выбранный адрес доставки                        | FK → CustomerAddress.address_id    |
| `order_status`        | VARCHAR       | Текущий статус заказа (см. `Order_Statuses.md`) |                                    |
| `total_amount`        | DECIMAL(10,2) | Итоговая стоимость заказа                       |                                    |
| `created_at`          | DATETIME      | Дата и время создания заказа                    |                                    |
| `updated_at`          | DATETIME      | Дата и время последнего изменения заказа        |                                    |

**Связи:**

- `Order N → 1 Customer`
- `Order N → 1 Restaurant`
- `Order N → 0..1 Courier`
- `Order 1 → N OrderItem`
- `Order 1 → 0..1 Payment`
- `Order 1 → N OrderHistoryEvent`

---

### 3.6 Строка заказа (OrderItem)

| Поле            | Тип данных    | Описание                             | Ключ                       |
| --------------- | ------------- | ------------------------------------ | -------------------------- |
| `order_item_id` | INTEGER       | Идентификатор строки заказа          | PK                         |
| `order_id`      | INTEGER       | Идентификатор заказа                 | FK → Order.order_id        |
| `menu_item_id`  | INTEGER       | Идентификатор позиции меню           | FK → MenuItem.menu_item_id |
| `quantity`      | INTEGER       | Количество                           |                            |
| `unit_price`    | DECIMAL(10,2) | Цена за единицу на момент оформления |                            |
| `line_total`    | DECIMAL(10,2) | Сумма по строке                      |                            |

---

### 3.7 Оплата (Payment)

| Поле                   | Тип данных    | Описание                                                                  | Ключ                         |
| ---------------------- | ------------- | ------------------------------------------------------------------------- | ---------------------------- |
| `payment_id`           | INTEGER       | Идентификатор оплаты в системе Delivery                                   | PK                           |
| `order_id`             | INTEGER       | Идентификатор заказа                                                      | FK → Order.order_id (UNIQUE) |
| `payment_status`       | VARCHAR       | Статус оплаты (например: «Ожидает оплаты», «Оплачен», «Оплата не прошла») |                              |
| `amount`               | DECIMAL(10,2) | Сумма оплаты                                                              |                              |
| `payment_provider`     | VARCHAR       | Наименование платёжного сервиса                                           |                              |
| `provider_payment_id`  | VARCHAR       | Идентификатор операции в платёжном сервисе (если получен)                 |                              |
| `provider_result_code` | VARCHAR       | Код/результат от платёжного сервиса (если применяется)                    |                              |
| `created_at`           | DATETIME      | Дата и время создания оплаты                                              |                              |
| `updated_at`           | DATETIME      | Дата и время обновления статуса оплаты                                    |                              |

**Связи:**

- `Payment 1 → 1 Order`

---

### 3.8 Курьер (Courier)

| Поле             | Тип данных | Описание                                                          | Ключ |
| ---------------- | ---------- | ----------------------------------------------------------------- | ---- |
| `courier_id`     | INTEGER    | Уникальный идентификатор курьера                                  | PK   |
| `full_name`      | VARCHAR    | Отображаемое имя курьера                                          |      |
| `phone`          | VARCHAR    | Номер телефона курьера                                            |      |
| `courier_status` | VARCHAR    | Доступность курьера (например: «Доступен», «Занят», «Недоступен») |      |
| `created_at`     | DATETIME   | Дата и время создания профиля                                     |      |
| `is_active`      | BOOLEAN    | Признак активности аккаунта                                       |      |

---

### 3.9 История изменений заказа (OrderHistoryEvent)

| Поле             | Тип данных | Описание                                                                     | Ключ                |
| ---------------- | ---------- | ---------------------------------------------------------------------------- | ------------------- |
| `event_id`       | INTEGER    | Идентификатор события                                                        | PK                  |
| `order_id`       | INTEGER    | Идентификатор заказа                                                         | FK → Order.order_id |
| `event_type`     | VARCHAR    | Тип события (изменение статуса заказа/оплаты, эскалация и т.п.)              |                     |
| `actor_role`     | VARCHAR    | Роль инициатора (`Клиент`, `Ресторан`, `Курьер`, `Администратор`, `Система`) |                     |
| `previous_value` | VARCHAR    | Предыдущее значение (статус/состояние)                                       |                     |
| `new_value`      | VARCHAR    | Новое значение (статус/состояние)                                            |                     |
| `description`    | VARCHAR    | Причина/комментарий (если фиксируется)                                       |                     |
| `created_at`     | DATETIME   | Дата и время фиксации события                                                |                     |

---

### 3.10 Администратор (Administrator)

| Поле         | Тип данных | Описание                                | Ключ |
| ------------ | ---------- | --------------------------------------- | ---- |
| `admin_id`   | INTEGER    | Уникальный идентификатор администратора | PK   |
| `full_name`  | VARCHAR    | Имя администратора                      |      |
| `email`      | VARCHAR    | Логин/почта администратора              |      |
| `created_at` | DATETIME   | Дата и время создания профиля           |      |
| `is_active`  | BOOLEAN    | Признак активности                      |      |

---

## 4. Ключевые связи между сущностями

- `Customer 1 → N Order`
- `Customer 1 → N CustomerAddress`
- `CustomerAddress 1 → N Order`
- `Restaurant 1 → N MenuItem`
- `Restaurant 1 → N Order`
- `Order 1 → N OrderItem`
- `Order 1 → 0..1 Payment`
- `Order 1 → N OrderHistoryEvent`
- `Courier 1 → N Order`

---
